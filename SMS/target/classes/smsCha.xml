<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="smsChans">
	<!-- Use type aliases to avoid typing the full classname every time. -->
	<resultMap id="smschaResult" 		type="cha">
		<result property="cha_no"    	 column="cha_no" />
		<result property="mem_no" 	     column="mem_no" />
		<result property="cha_title"     column="cha_title" />
		<result property="cha_cont"      column="cha_cont" />
		<result property="cha_date"      column="cha_date" />
		<result property="cha_id" 	     column="cha_id" />
		<result property="cha_count" 	 column="cha_count" />
	</resultMap>
	<select id="list" parameterType="cha" resultMap="smschaResult">
		select * from (select a.*, rowNum rn from (
			select * from SMS_cha 
<!-- 			<where>
				<if test="keyword!=null and keyword!=''">
					<if test="search=='subcon'">
						cha_title like '%'||#{keyword}||'%' or cha_cont like '%'||#{keyword}||'%'  
					</if>
					<if test="search!='subcon'">
						${search} like '%'||#{keyword}||'%'
					</if>
				</if>
			</where> -->
			order by cha_date desc) a)
			 where rn between #{startRow} and #{endRow} 
	</select>
	<select id="getTotal" parameterType="cha" resultType="int">
		select count(*) from SMS_cha
	</select>
	<select id="select" parameterType="cha" resultMap="smschaResult">
		select * from SMS_cha where mem_no = #{mem_no}
	</select>
	<insert id="insert" parameterType="cha">
 		 <selectKey keyProperty="cha_no" order="BEFORE" resultType="int">
				select nvl(max(cha_no), 0)+1 from SMS_cha
		</selectKey> 	
		insert into SMS_cha values(#{cha_no},#{mem_no},#{cha_title},#{cha_cont},sysdate,#{cha_id},0)
	</insert>
	<update id="updateReadcount" parameterType="int">
		update SMS_cha set cha_count = cha_count+1 where cha_no=#{ncha_noum}
	</update>
	<select id="selectno" parameterType="int">
		select * from  SMS_cha where cha_no = #{cha_no}
	</select>
</mapper>